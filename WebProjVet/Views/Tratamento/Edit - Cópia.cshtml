@using WebProjVet.Models.ViewModels

@model WebProjVet.Models.Tratamento

@{
    ViewData["Title"] = "Edit";
}

<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>

<h2>Edit</h2>

<h4>Tratamento</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Edit">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="Id" id="idTratamento" />
            <div class="form-group">
                <label asp-for="DataInicio" class="control-label"></label>
                <input asp-for="DataInicio" class="form-control" />
                <span asp-validation-for="DataInicio" class="text-danger"></span>
            </div>
            
            <div class="form-group">
                <label asp-for="DataFim" class="control-label"></label>
                <input asp-for="DataFim" disabled="disabled" class="form-control" />
                <span asp-validation-for="DataFim" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="DoadoraId" class="control-label"></label>
                <select asp-for="DoadoraId" class="form-control"
                        asp-items="@(new SelectList(ViewBag.DoadoraId, "Id", "Nome"))">
                    <option selected="selected" value="">Selecione</option>
                </select>
                <span asp-validation-for="DoadoraId" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="GaranhaoId" class="control-label"></label>
                <select asp-for="GaranhaoId" class="form-control"
                        asp-items="@(new SelectList(ViewBag.GaranhaoId, "Id", "Nome"))">
                    <option selected="selected" value="">Selecione</option>
                </select>
                <span asp-validation-for="GaranhaoId" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ReceptoraId" class="control-label"></label>
                <select asp-for="ReceptoraId" class="form-control"
                        asp-items="@(new SelectList(ViewBag.ReceptoraId, "Id", "Codigo"))">
                    <option selected="selected" value="">Selecione</option>
                </select>
                <span asp-validation-for="ReceptoraId" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="TratamentoSituacao" class="control-label"></label>
                <select asp-for="TratamentoSituacao" asp-items="Html.GetEnumSelectList<TratamentoSituacao>()" class="form-control">
                    <option selected="selected" value="">Selecione</option>
                </select>
                <span asp-validation-for="TratamentoSituacao" class="text-danger"></span>
            </div>

            <!--Seção da lista para Adição dos serviços-->
            <div class="form-group">
                <div class="col-lg-8">
                    <label class="control-label">Serviços</label>
                    <select id="sltServico" class="form-control"
                            asp-items="@(new SelectList(ViewBag.ServicoId, "Id", "Nome", "Valor"))">
                        <option selected="selected" value="">Selecione</option>
                    </select>
                </div>
                <div class="col-lg-2">
                    <label class="control-label">Valor</label>
                    <input id="txtValor" class="form-control" />
                </div>
                <div class="col-lg-2">
                    <input type="button" value="Adicionar" class="btn btn-primary" onclick="AdicionarServico()" />
                </div>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <td>ID</td>
                            <td>NOME</td>
                            <td>VALOR</td>
                            <td>DATA</td>
                        </tr>
                    </thead>
                    <tbody id="listaServicos">
                        <!--Lista dos serviços cadastrados -->
                        <!--https://stackoverflow.com/questions/14165632/asp-net-mvc-4-for-loop-posts-model-collection-properties-but-foreach-does-not-->
                        @foreach (var item in Model.TratamentoServicos)
                        {
                            <tr>
                                <td style="display:none">
                                    @Html.DisplayFor(modelItem => item.Id)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Servico.Nome)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Valor)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Data)
                                </td>
                                <td>
                                    <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                                    <a asp-action="Details" asp-route-id="@item.Id">Details</a> |
                                    <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
                <div style="float:left; font-size:22px">Total: R$</div>
                <div id="divTotal" style="float:left; font-size:22px; margin-left:5px">0.00</div>
                <br /><br />

                <textarea asp-for="TratamentoServicosJson" id="ListaServicoJson" style="display:none"></textarea>
            </div>



            <div class="form-group">
                <input type="submit" value="Save" class="btn btn-default" />
            </div>
        </form>
    </div>
</div>



@*@Html.Partial("_TratamentoServico.cshtml", Model.TratamentoServicos)*@



<div class="container">
    <div class="row">


        <div class="col-md-12">
            <h4>Bootstrap Snipp for Datatable</h4>
            <div class="table-responsive">

                <table id="mytable" class="table table-bordred table-striped">

                    <thead>

                    <th><input type="checkbox" id="checkall" /></th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Address</th>
                    <th>Email</th>
                    <th>Contact</th>
                    <th>Edit</th>

                    <th>Delete</th>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="checkbox" class="checkthis" /></td>
                            <td>Mohsin</td>
                            <td>Irshad</td>
                            <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                            <td>isometric.mohsin@gmail.com</td>
                            <td>+923335586757</td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Edit"><button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button></p></td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button></p></td>
                        </tr>

                        <tr>
                            <td><input type="checkbox" class="checkthis" /></td>
                            <td>Mohsin</td>
                            <td>Irshad</td>
                            <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                            <td>isometric.mohsin@gmail.com</td>
                            <td>+923335586757</td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Edit"><button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button></p></td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button></p></td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="checkthis" /></td>
                            <td>Mohsin</td>
                            <td>Irshad</td>
                            <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                            <td>isometric.mohsin@gmail.com</td>
                            <td>+923335586757</td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Edit"><button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button></p></td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button></p></td>
                        </tr>



                        <tr>
                            <td><input type="checkbox" class="checkthis" /></td>
                            <td>Mohsin</td>
                            <td>Irshad</td>
                            <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                            <td>isometric.mohsin@gmail.com</td>
                            <td>+923335586757</td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Edit"><button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button></p></td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button></p></td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="checkthis" /></td>
                            <td>Mohsin</td>
                            <td>Irshad</td>
                            <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                            <td>isometric.mohsin@gmail.com</td>
                            <td>+923335586757</td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Edit"><button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button></p></td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button></p></td>
                        </tr>





                    </tbody>

                </table>

                <div class="clearfix"></div>
                <ul class="pagination pull-right">
                    <li class="disabled"><a href="#"><span class="glyphicon glyphicon-chevron-left"></span></a></li>
                    <li class="active"><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">5</a></li>
                    <li><a href="#"><span class="glyphicon glyphicon-chevron-right"></span></a></li>
                </ul>

            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                <h4 class="modal-title custom_align" id="Heading">Edit Your Detail</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input class="form-control " type="text" placeholder="Mohsin">
                </div>
                <div class="form-group">

                    <input class="form-control " type="text" placeholder="Irshad">
                </div>
                <div class="form-group">
                    <textarea rows="2" class="form-control" placeholder="CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan"></textarea>
                </div>
            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-warning btn-lg" style="width: 100%;"><span class="glyphicon glyphicon-ok-sign"></span> Update</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                <h4 class="modal-title custom_align" id="Heading">Delete this entry</h4>
            </div>
            <div class="modal-body">

                <div class="alert alert-danger"><span class="glyphicon glyphicon-warning-sign"></span> Are you sure you want to delete this Record?</div>

            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-success"><span class="glyphicon glyphicon-ok-sign"></span> Yes</button>
                <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> No</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>















<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<script>
    var Itens = new Object();
    Itens.Servicos = new Array();

    var CodigoTratamento = document.getElementById("idTratamento");
    var CodigoServico = document.getElementById("sltServico");
    var ValorServico = document.getElementById("txtValor");
    var ListaServico = document.getElementById("listaServicos");
    var TotalServico = document.getElementById("divTotal");
    var ListaServicoJson = document.getElementById("ListaServicoJson");
    var DataRegistro = Date.now();


    function AdicionarServico() {

        var valorFormatado = ValorServico.value;
        valorFormatado = Math.round(valorFormatado * 100) / 100;


        Itens.Servicos.push({
            "TratamentoId": CodigoTratamento.value,
            "ServicoId": CodigoServico.value,
            //"NomeServico": CodigoServico.options[CodigoServico.selectedIndex].text,
            "Valor": valorFormatado, //ValorServico.value,
            "DataRegistro": DataRegistro.value

        });

        ListaServicoJson.innerHTML = JSON.stringify(Itens.Servicos);

        var servico =
            "<tr>" +
            "<td>" + "" + "</td>" +
            "<td>" + CodigoServico.options[CodigoServico.selectedIndex].text + "</td>" +
            "<td> R$" + valorFormatado + "</td>" +
            "<td>" + DataRegistro.value + "</td>" +
            "</tr>";

        ListaServico.innerHTML += servico;
        var totalGeral = Math.round((TotalServico.innerText * 1 + valorFormatado) * 100) / 100;
        TotalServico.innerHTML = totalGeral;
    }
</script>

<script>
    $(document).ready(function () {
        $("#mytable #checkall").click(function () {
            if ($("#mytable #checkall").is(':checked')) {
                $("#mytable input[type=checkbox]").each(function () {
                    $(this).prop("checked", true);
                });

            } else {
                $("#mytable input[type=checkbox]").each(function () {
                    $(this).prop("checked", false);
                });
            }
        });

        $("[data-toggle=tooltip]").tooltip();
    });
</script>
